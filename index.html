<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tap to Place</title>
  <script src="//cdn.8thwall.com/web/aframe/8frame-1.3.0.min.js"></script>
  <script src="//cdn.8thwall.com/web/xrextras/xrextras.js"></script>
  <script src="//cdn.8thwall.com/web/landing-page/landing-page.js"></script>
  <script src="//apps.8thwall.com/xrweb?appKey=4AHlJqYnByKJbRtGgXRhMSB6cqzsTMNWbda0blpvJTKp02mYcNqVPxclnlcxuomvVpr3dS"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a-scene tap-place landing-page xrextras-loading xrextras-runtime-error renderer="colorManagement:true" xrweb="allowedDevices: any">
    <a-camera id="camera" position="0 8 0" raycaster="objects: .cantap" cursor="fuse: false; rayOrigin: mouse;"></a-camera>

    <a-entity light="type: directional; intensity: 0.8; castShadow: true; shadowMapHeight:2048; shadowMapWidth:2048; shadowCameraTop: 20; shadowCameraBottom: -20; shadowCameraRight: 20; shadowCameraLeft: -20; target: #camera" xrextras-attach="target: camera; offset: 8 15 4" position="1 4.3 2.5" shadow></a-entity>

    <a-light type="ambient" intensity="0.5"></a-light>

    <a-box id="floor" class="cantap" scale="1000 2 1000" position="0 -1 0" material="shader: shadow; transparent: true; opacity: 0.4" shadow></a-box>
  </a-scene>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const floor = document.getElementById('floor');

      floor.addEventListener('click', (event) => {
        const slabSize = floor.getAttribute('scale');
        const slabWidth = parseFloat(slabSize.x);
        const slabDepth = parseFloat(slabSize.z);
        const slabHeight = parseFloat(slabSize.y);

        const newElement = document.createElement('a-box');
        newElement.setAttribute('position', event.detail.intersection.point.x + ' ' + event.detail.intersection.point.y + ' ' + event.detail.intersection.point.z);
        newElement.setAttribute('rotation', '0 60 0');
        newElement.setAttribute('visible', 'false');
        newElement.setAttribute('scale', '0.1 0.1 0.1');
        newElement.setAttribute('shadow', 'receive: false');
        newElement.setAttribute('geometry', `primitive: box; width: ${slabWidth}; height: ${slabHeight}; depth: ${slabDepth}`);
        newElement.setAttribute('material', 'color: #fff; roughness: 1; metalness: 0');

        document.querySelector('a-scene').appendChild(newElement);

        newElement.addEventListener('model-loaded', () => {
          newElement.setAttribute('visible', 'true');
        });
      });
    });
  </script>
</body>
</html>
